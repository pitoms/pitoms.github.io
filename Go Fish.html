<!doctype html>
<!-- Weiming Huang -->
<html>
<head>
    <title>Go Fish</title>
    <style>
        img{width:78px; height:107px;border: 1px solid black;}
    </style>
    <script src= "playingcards.js"></script>
    <script type = "text/javascript">
        var playerpiles =0;
        var computerpiles = 0;

        function fillPlayerHands()
        {
            deck = generateStandardDeck();
            deck = shuffleDeck(deck);
            computerhand = deck.splice(0,7);
            playerhand = deck.splice(0,7);
            computerranks = new Array();
            playerranks = new Array();
            computerimages = new Array();
            playerimages = new Array();
            
            for (i=0;i<7;i++) {
                computerranks[i] = parseInt(extractCardData(computerhand[i], RANK));
                playerranks[i] = parseInt(extractCardData(playerhand[i], RANK));
                ComputerCardSpaces[i].src = "cardimages/back-blue-75-1.png";
                computerimages[i] = "cardimages/" + extractCardData(computerhand[i], IMAGE);
                PlayerCardSpaces[i].src = "cardimages/" + extractCardData(playerhand[i], IMAGE);
                playerimages[i] = "cardimages/" + extractCardData(playerhand[i], IMAGE)
            }
        }
        function dropCards(cardranks, hand,imgspaces,pile,imgarray)
        {
            for (var x=1; x<14;x++) {
                var count = 0;
                checkingArray = new Array();
                for (var y= 0;y<cardranks.length;y++) {
                    if (cardranks[y] == x) {
                        checkingArray.push(y);
                    }
                }
                if (checkingArray.length==4) {
                    for (z= 0; z<4;z++) {
                        imgspaces[checkingArray[z]].src = null;
                        cardranks[checkingArray[z]] = null;
                        hand[checkingArray[z]] = null;
                        pile++;
                        imgarray[checkingArray[z]] = null;
                        
                    }
                    
                    
                }
            }
        }
        function requestCard(cardrank, enemyhand, enemyranks, enemyimgspaces,hand,ranks,imgspaces, enemyimgarray, imgarray) {
            item = 0;
            for (var y= 0; y<enemyhand.length;y++) {
                if (enemyranks[y] == cardrank) {
                    getLastIndex(imgspaces);
                    ranks[playeremptycard] = enemyranks[y];
                    hand[playeremptycard]= enemyhand[y];
                    imgarray[playeremptycard] = enemyimgarray[y];
                    enemyranks[y] = null;
                    enemyhand[y] = null;
                    enemyimgspaces[y].src = null;
                    enemyimgarray[y] = null;
                    item++;
                    
                    if (imgspaces== ComputerCardSpaces) {
                        imgspaces[playeremptycard].src = "cardimages/back-blue-75-1.png"
                    }
                    else{
                        imgspaces[playeremptycard].src = enemyimgarray[y];
                    }
                }
            }
            if (item==0) {
                goFish(ranks, hand, imgspaces, imgarray)
            }
            if (hand == playerhand) {
                computerTurn();
            }
            
            winCondition();
        }
        function goFish(cardranks, hand, imgspaces,imgarray) {
            getLastIndex(imgspaces);
            card = dealCard(deck);
            cardranks[playeremptycard]= parseInt(extractCardData(card, RANK));
            hand[playeremptycard] = card;
            imgarray[playeremptycard] = "cardimages/" + extractCardData(card, IMAGE);
            
            if (imgspaces== ComputerCardSpaces) {
                imgspaces[playeremptycard].src = "cardimages/back-blue-75-1.png"
            }
            else{
                imgspaces[playeremptycard].src = imgarray[playeremptycard];
            }
        }
        function winCondition() {
            if (playerhand.length == 0) {
                document.getElementById("computercards").innerHTML = "You Win!"
                document.getElementById("playercards").style.visibility = "hidden"
            }
            else if (computerhand.length ==0) {
                document.getElementById("computercards").innerHTML = "You Lose!"
                document.getElementById("playercards").style.visibility = "hidden"
            }
            else if (deck.length == 0) {
                if (playerpiles>computerpiles) {
                document.getElementById("computercards").innerHTML = "You Win!"
                document.getElementById("playercards").style.visibility = "hidden"                   //code
                }
                else{
                document.getElementById("computercards").innerHTML = "You Lose!"
                document.getElementById("playercards").style.visibility = "hidden"                   
                }
            }
        }
        function computerTurn() {
            random = parseInt(Math.random() * computerhand.length);
            requestCard(computerranks[random], playerhand, playerranks, PlayerCardSpaces, computerhand,computerranks, ComputerCardSpaces,playerimages,computerimages);
            dropCards(computerranks,computerhand,ComputerCardSpaces,computerpiles,computerimages);
            winCondition();
            
        }
        function getLastIndex(imgspaces) {
            for (var a = 0; a<imgspaces.length;a++) {
                if (imgspaces[a].src == "") {
                    playeremptycard = a;
                    break;
                }
            }
        }
    </script>
</head>
<body>
    <div id= "computercards">
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
    </div><br />
    <div id= "playercards">
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
        <img />
    </div>
    <button onclick= "alert(checkingArray)">test</button>
    <button onclick = "requestCard(1,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request Ace</button>
    <button onclick = "requestCard(2,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request 2</button>
    <button onclick = "requestCard(3,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request 3</button>
    <button onclick = "requestCard(4,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request 4</button>
    <button onclick = "requestCard(5,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request 5</button>
    <button onclick = "requestCard(6,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request 6</button>
    <button onclick = "requestCard(7,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request 7</button>
    <button onclick = "requestCard(8,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request 8</button>
    <button onclick = "requestCard(9,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request 9</button>
    <button onclick = "requestCard(10,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request 10</button>
    <button onclick = "requestCard(11,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request Jack</button>
    <button onclick = "requestCard(12,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request Queen</button>
    <button onclick = "requestCard(13,computerhand,computerranks,ComputerCardSpaces,playerhand,playerranks,PlayerCardSpaces,computerimages,playerimages)">Request King</button>


    <button onclick ="">go fish</button>
    <button onclick="dropCards(playerranks, playerhand, PlayerCardSpaces, playerpiles, playerimages);">drop cards</button>
    <script>
        ComputerCardSpaces = document.getElementById("computercards").getElementsByTagName("img");
        PlayerCardSpaces = document.getElementById("playercards").getElementsByTagName("img");
        fillPlayerHands();
        getLastIndex(PlayerCardSpaces);

    </script>
</body>
</html>
